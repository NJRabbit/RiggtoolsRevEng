function openText(a,b){if(instances[b].contentWindow.slaveWindow!==!1)return instances[b].contentWindow.slaveWindow.contentWindow.window.close(),instances[b].contentWindow.slaveWindow=!1,openText(a,b);var c=196,d=236;switch(a){case"help":c=280,d=320;break;case"info":break;default:window.close()}chrome.app.window.create("popout.html",{bounds:{width:c,height:d},innerBounds:{width:c,height:d},id:b+"-slave",frame:"none",hidden:!0,resizable:!1},function(e){instances[b].contentWindow.slaveWindow=e,e.contentWindow.type=a,e.contentWindow.id=b+"-slave",e.contentWindow.app=!0,e.contentWindow.width=c,e.contentWindow.height=d,e.contentWindow.marginx=marginx*b+20,e.contentWindow.marginy=marginy*b+20,instances[b].contentWindow.jQuery(".drag").addClass("drag-disabled").removeClass("drag"),instances[b].contentWindow.jQuery(".blackout").css("display","block"),$(instances[b].contentWindow.window).focus(function(){e.drawAttention(),e.focus(),e.contentWindow.jQuery("body").stop().animate({opacity:.1},100,function(){e.contentWindow.jQuery("body").stop().animate({opacity:1},100,function(){e.clearAttention()})})}),e.onClosed.addListener(function(){instances[b].contentWindow.slaveWindow=!1,instances[b].contentWindow.enable(),instances[b].contentWindow.jQuery(".drag-disabled").addClass("drag").removeClass("drag-disabled"),instances[b].contentWindow.jQuery(".blackout").css("display","none"),console.log("Closed Instance"+instances.indexOf(app)+"-slave")})})}function openWindow(a,b){console.log("Browser mode not working, opening app..."),chrome.storage.local.set({mode:"app"}),create("app")}function create(a){"undefined"!=typeof instances[openInstance]&&null!==instances[openInstance]?(instance=instances.length,openInstance=instance):instance=openInstance,console.log("Creating Instance"+instance+"..."),"browser"===a?instances[instance]=openWindow("index.html","Calculator_"+instance):(width=220,height=379,chrome.app.window.create("index.html",{bounds:{width:width,height:height},innerBounds:{width:width,height:height},id:String(instance),frame:"none",hidden:!0,resizable:!1},function(a){instances[instance]=a,a.contentWindow.id=instance,a.contentWindow.app=!0,a.contentWindow.width=width,a.contentWindow.height=height,a.contentWindow.marginx=marginx*instance,console.log("Instance"+instance+" set marginx to "+a.contentWindow.marginx),a.contentWindow.marginy=marginy*instance,console.log("Instance"+instance+" set marginy to "+a.contentWindow.marginy),a.onClosed.addListener(function(){openInstance=instances.indexOf(a),instances[openInstance].contentWindow.slaveWindow!==!1&&instances[openInstance].contentWindow.slaveWindow.contentWindow.window.close(),instances[openInstance]=null,console.log("Closed Instance"+instances.indexOf(a))})})),console.log("Instance"+instance+" created"),openInstance++}function init(){chrome.storage.local.getBytesInUse("mode",function(a){0===a&&chrome.storage.local.set({mode:"app"})}),chrome.storage.local.get("mode",function(a){create(a.mode)})}var instances=[],openInstance=instances.length;marginx=30,marginy=30,app=!1,chrome.app.runtime.onLaunched.addListener(function(){init()}),chrome.app.runtime.onRestarted.addListener(function(){init()}),chrome.runtime.onInstalled.addListener(function(){}),chrome.contextMenus.onClicked.addListener(function(a){console.log("Context menu was clicked: "+a.menuItemId),"app"===a.menuItemId?create("app"):"browser"===a.menuItemId?create("browser"):"load"===a.menuItemId&&init()});