/*Copyright (c) Aidan Taylor - http://aidantaylor.net*/

function fixMethod(){var a=Method.html();Method.html("<span>"+a+"</span>");var b=Method.find("span:first").width();Method.html(a),Method.scrollLeft=b,b<Method.width()?Overflow.stop().hide(500).hide():Overflow.stop().show(500).show()}function enter(a,b,c){input!==!1&&(c!==!0&&(beforeLastEntry=calc),b!==!0&&(calc+=Screen.val(),Screen.val(0)),calc+=a,Method.html(calc),fixMethod())}function key(a,b){if(disabled===!0)return!1;var c=Screen.val(),d=Method.html();switch(b!==!1&&input===!1&&"m+"!==a&&"m-"!==a&&"ms"!==a&&"mc"!==a&&"mr"!==a&&"="!==a&&"equals"!==a&&"+"!==a&&"plus"!==a&&"1\\x"!==a&&"reciproc"!==a&&"-"!==a&&"minus"!==a&&"*"!==a&&"×"!==a&&"times"!==a&&"÷"!==a&&"/"!==a&&"divide"!==a&&"√"!==a&&"sqrt"!==a&&"squareroot"!==a&&"±"!==a&&"+/-"!==a&&"plus-minus"!==a&&"minus-plus"!==a&&key("ac",!1),b===!1||input2!==!1&&input3!==!1||("M+"!==a&&"M-"!==a&&"MS"!==a&&"MC"!==a&&"MR"!==a&&"="!==a&&"equals"!==a&&"+"!==a&&"plus"!==a&&"-"!==a&&"minus"!==a&&"*"!==a&&"×"!==a&&"times"!==a&&"÷"!==a&&"/"!==a&&"divide"!==a?(input2===!1&&(calc=beforeLastEntry,Method.html(beforeLastEntry)),key("ce",!1),input2=!0,input3=!0):input2===!1&&Screen.val("0")),a){case"ac":case"clear":beforeLastEntry="",calc=0,Screen.val(0),Method.html(""),input=!0,input2=!0,input3=!0,input4=!0,input5=!1,input6=!1,bracket=!1,beforeLastEntry=0,fixMethod();break;case"ce":case"clearentry":input===!1?key("ac"):(Screen.val(0),input5=!1);break;case"=":case"equals":if(editingHistory===!0);else if(input===!1)calc=beforeLastEntry,Method.html(calc),input=!0,key("equals");else{beforeLastEntry=calc,input2!==!1&&enter("",!0,!1),")"!==calc.substring(calc.length-1,calc.length)&&(calc+=parseFloat(c)),old_calc=calc,Method.html(old_calc+"=");try{f=math.eval(calc),f=math.round(parseFloat(parseFloat(f).toFixed(9)),9),console.log(old_calc+"="+f),History[History.length]=[old_calc,f],Screen.val(f)}catch(e){Method.html(""),Screen.val(e)}calc=0,input=!1,input2=!0,input3=!0,input5=!1,input6=!1,fixMethod()}break;case"←":case"backspace":var f=c;f=f.substring(0,f.length-1),""===f?Screen.val(0):Screen.val(f);break;case"copy":Screen.focus().select(),document.execCommand("Copy",!1,null),Screen.blur(),document.getSelection().removeAllRanges();break;case"cut":key("copy"),input===!1&&(Method.val(""),input=!0),Screen.val(0);break;case"paste":Screen.focus().select(),document.execCommand("Paste",!1,null),Screen.blur(),document.getSelection().removeAllRanges();break;case"esc":editingHistory===!0||key("close");break;case"close":window.close();break;case"min":case"minimize":chrome.app.window.current().minimize();break;case"m+":memory+=math.eval(Screen.val()),0===memory?Memory.hide(500):Memory.show(500);break;case"m-":memory-=math.eval(Screen.val()),0===memory?Memory.hide(500):Memory.show(500);break;case"ms":memory=math.eval(Screen.val()),0===memory?Memory.hide(500):Memory.show(500);break;case"mr":Screen.val(memory),0===memory?Memory.hide(500):Memory.show(500);break;case"mc":memory=0,Memory.hide(500);break;default:switch(0===calc&&(calc=""),a){case"+":case"plus":if(input4===!0)return calc=calc.substring(0,calc.length-1),input4=!1,void key(a);input===!1?(Method.html(calc),input=!0,enter("+")):(""!==calc&&"0"===Screen.val()?(enter("+",!0),Screen.val(0)):(enter("+",!input2),input2===!1&&(input2=!0)),input=!0),input2=!0,input3=!0,input4=!0,input5=!1;break;case"-":case"minus":if(input4===!0)return calc=calc.substring(0,calc.length-1),input4=!1,void key(a);input===!1?(Method.html(calc),input=!0,enter("-")):""!==calc&&"0"===Screen.val()?(enter("-",!0),Screen.val(0)):(enter("-",!input2),input2===!1&&(input2=!0)),input2=!0,input3=!0,input4=!0,input5=!1,input=!0;break;case"×":case"*":case"times":if(input4===!0)return calc=calc.substring(0,calc.length-1),input4=!1,void key(a);input===!1?(Method.html(calc),input=!0,enter("*")):""!==calc&&"0"===Screen.val()?(enter("*",!0),Screen.val(0)):(enter("*",!input2),input2===!1&&(input2=!0)),input2=!0,input3=!0,input4=!0,input5=!1,input=!0;break;case"÷":case"/":case"divide":if(input4===!0)return calc=calc.substring(0,calc.length-1),input4=!1,void key(a);input===!1?(Method.html(calc),input=!0,enter("/")):""!==calc&&"0"===Screen.val()?(enter("/",!0),Screen.val(0)):(enter("/",!input2),input2===!1&&(input2=!0)),input2=!0,input3=!0,input4=!0,input5=!1,input=!0;break;case"•":case".":case"decimal":if(math.eval(c)%1!==0||c.indexOf(".")!==-1&&c.indexOf("..")===-1)return;for(var g=0;g<c.length;g++)if(Screen[g]===a)return!1;"0"===c?Screen.val("0."):Screen.val(c+"."),input4=!1;break;case"±":case"+/-":case"plus-minus":case"minus-plus":input===!1?(input=!0,key("ac"),Screen.val(c),key("plus-minus")):(a=parseFloat(c),a*=-1,Screen.val(a),input4=!1);break;case"%":case"percent":""===calc?(enter(0,!0),temp2=0):temp2=calc,Screen.val(parseFloat(temp2)*parseFloat(c/100)),beforeLastEntry=d,input3=!1,input4=!1;break;case"sin":input===!1?(input=!0,key("ac"),Screen.val(c),key("sin")):(tcalc=calc,enter("sin("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.sin(parseFloat(c)))),input2=!1,input4=!1;break;case"tan":input===!1?(input=!0,key("ac"),Screen.val(c),key("tan")):(tcalc=calc,enter("tan("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.tan(parseFloat(c)))),input2=!1,input4=!1;break;case"cos":input===!1?(input=!0,key("ac"),Screen.val(c),key("cos")):(tcalc=calc,enter("cos("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.cos(parseFloat(c)))),input2=!1,input4=!1;break;case"√":case"sqrt":case"squareroot":input===!1?(input=!0,key("ac"),Screen.val(c),key("sqrt")):(tcalc=calc,enter("sqrt("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.sqrt(parseFloat(c)))),input2=!1,input4=!1;break;case"rnd":case"round":input===!1?(input=!0,key("ac"),Screen.val(c),key("round")):(tcalc=calc,enter("round("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.round(parseFloat(c)))),input2=!1,input4=!1;break;case"!":case"fact":input===!1?(input=!0,key("ac"),Screen.val(c),key("fact")):(tcalc=calc,bracket===!0?(enter(c+"!)",!0,!0),bracket=!1):enter("("+c+"!)",!0,!0),beforeLastEntry=tcalc,Screen.val(math.eval(parseFloat(c)+"!"))),input2=!1,input5=!0,input4=!1;break;case"π":case"pi":input===!1?(input=!0,key("ac"),Screen.val(c),key("pi")):Screen.val(math.eval("pi")),input3=!1,input4=!1;break;case"exp":input===!1?(input=!0,key("ac"),Screen.val(c),key("exp")):0!==Screen.val()&&(Screen.val().indexOf(".")>-1?Screen.val(Screen.val()+"e+0"):Screen.val(Screen.val()+".e+0")),input6=!0;break;case"inv":case"in":input===!1?(input=!0,key("ac"),Screen.val(c),key("in")):(tcalc=calc,enter("in("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.round(parseFloat(parseFloat(1/c).toFixed(9)),9))),input2=!1,input4=!1;break;case"log":input===!1?(input=!0,key("ac"),Screen.val(c),key("log")):(tcalc=calc,enter("log10("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.log(parseFloat(c),10))),input2=!1,input4=!1;break;case"1\\x":case"reciproc":input===!1?(input=!0,key("ac"),Screen.val(c),key("reciproc")):(tcalc=calc,enter("(1 / "+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.round(parseFloat(parseFloat(1/c).toFixed(9)),9))),input2=!1,input4=!1;break;case"x2":case"sqr":case"^2":input===!1?(input=!0,key("ac"),Screen.val(c),key("x2")):(tcalc=calc,enter(c+"^2",!0,!0),beforeLastEntry=tcalc,Screen.val(math.eval(parseFloat(c)+"^2"))),input2=!1,input4=!1;break;case"10x":case"10^":case"10^x":input===!1?(input=!0,key("ac"),Screen.val(c),key("10^")):(tcalc=calc,enter("10^("+c+")",!0,!0),beforeLastEntry=tcalc,Screen.val(math.eval("10^("+parseFloat(c)+")"))),input2=!1,input4=!1;break;case"xy":case"^":input===!1?(input=!0,key("ac"),Screen.val(c),key("xy")):(enter(c+"^",!0,!0),Screen.val(0));break;case"mod":input===!1?(input=!0,key("ac"),Screen.val(c),key("mod")):(enter(c+" mod ",!0,!0),Screen.val(0));break;case"(":if(input5===!0)return;bracket===!1&&(bracket=!0,enter("(",!0,!0));break;case")":if(input5===!0)return;if(bracket===!0){var h=calc.substring(calc.length-1,calc.length);")"===h?(calc=calc.substring(0,calc.length-1),Method.html(calc)):(0!==c||"+"!==h&&"-"!==h&&"/"!==h&&"*"!==h||(calc=calc.substring(0,calc.length-1),Method.html(calc)),bracket=!1,input5=!0,enter(")"))}break;default:f=Screen.val(),exp=".e+",f=f.split(exp),null===f&&(exp="e+",f=f.split(exp)),null!==f&&0===f[1]&&Screen.val(f[0]+exp),a%1===0&&("0"===Screen.val()&&"0."!==Screen.val()?Screen.val(a):Screen.val(Screen.val()+a),input4=!1)}}}function resize(){if(app===!0){var a=chrome.app.window.current();a.resizeTo(Math.floor(width),Math.floor(height)),console.log(width+" "+height)}}function popoutSetup(){var a=$(window).height();$(".popout .texts").css({height:a+"px"})}function enable(){disabled=!1,$("*").on()}function launcherMenu(){}var memory=0,calc=0,old_calc=calc,input=!0,input2=!0,input3=!0,input4=!0,input5=!1,input6=!1,beforeLastEntry="",History=[],editingHistory=!1,showingHistory=!1,bracket=!1,disabled=!1,slaveWindow=!1,Screen,Method,Icons,Overflow,Memory,Body;"undefined"==typeof app&&(app=!1),console.log("Loading..."),"undefined"==typeof id&&(id="Not set"),console.log("Instance ID: "+id),$(document).ready(function(){$(".calculator").hide().fadeIn(250),Screen=$("#screen"),Method=$("#method"),Icons=$("#icons"),Overflow=$("#overflow"),Memory=$("#memory"),Body=$("body"),app===!0&&Body.removeClass("browser"),"undefined"!=typeof type&&($(".texts").load("./"+type+".html",function(){$("a.open").click(function(){window.open($(this).attr("href"))})}),$("title").html("Calculator "+type),$(".calc-options").html("Calculator "+type)),popoutSetup(),resize()}),$(window).resize(function(a){return resize(a)});var oldx=window.screenX,oldy=window.screenY,posx=0,posy=0;chrome.storage.local.getBytesInUse("theme",function(a){0===a&&(chrome.storage.local.set({theme:"light"}),console.log("Set theme value to light"))}),chrome.storage.local.getBytesInUse("inputset",function(a){0===a&&(chrome.storage.local.set({inputset:"standard"}),console.log("Set inputset value to standard"))}),chrome.storage.local.getBytesInUse("mode",function(a){0===a&&(chrome.storage.local.set({mode:"app"}),console.log("Set mode value to app"))}),chrome.storage.local.get("theme",function(a){console.log("got theme, value is "+a.theme);var b=a.theme;$("#"+b).parent("li").addClass("active"),$("body").addClass(b)}),$("html").hasClass("popout")||chrome.storage.local.get("inputset",function(a){switch(console.log("got inputset, value is "+a.inputset),inputset=a.inputset,inputset){case"scientific":width=274,height=435}var b=$("body");b.addClass(inputset),b.hasClass("browser")?$("."+inputset).css("display","block"):$("."+inputset).css("display","inline-block"),resize(),$("#"+inputset).parent("li").addClass("active")}),chrome.storage.local.get("mode",function(a){console.log("got mode, value is "+a.mode),mode=a.mode,$("#"+mode).parent("li").addClass("active")}),app===!0&&(chrome.storage.local.getBytesInUse("posx",function(a){0===a&&(chrome.storage.local.set({posx:window.screenX+marginx}),console.log("Set posy value to "+window.screenX))}),chrome.storage.local.getBytesInUse("posy",function(a){0===a&&(chrome.storage.local.set({posy:window.screenY+marginy}),console.log("Set posy value to "+window.screenY))}),chrome.storage.local.get("posx",function(a){console.log("got posx, value is "+a.posx),posx=parseInt(a.posx)+marginx,oldx=window.screenX,0!==posx&&(window.moveTo(posx,window.screenY),console.log("Moving window to: "+posx+","+window.screenY),chrome.app.window.current().show())}),chrome.storage.local.get("posy",function(a){console.log("got posy, value is "+a.posy),posy=parseInt(a.posy)+marginy,oldy=window.screenY,0!==posy&&(window.moveTo(window.screenX,posy),console.log("Moving window to:"+window.screenX+","+posy),console.log("Loading Done..."),chrome.app.window.current().show())}),slaveWindow!==!0&&setTimeout(function(){setInterval(function(){oldx!==window.screenX&&(chrome.storage.local.set({posx:window.screenX-marginx}),realpos=window.screenX-marginx,console.log("Set posx value to "+window.screenX+" ("+realpos+")")),oldy!==window.screenY&&(chrome.storage.local.set({posy:window.screenY-marginy}),realpos=window.screenY-marginy,console.log("Set posy value to "+window.screenY+" ("+realpos+")")),oldx=window.screenX,oldy=window.screenY},500)},1e3));var replacements={},config={angles:"deg"};["sin","cos","tan","sec","cot","csc"].forEach(function(a){var b=math[a];replacements[a]=function c(a){if("boolean"==typeof a&&(a=+a),"number"==typeof a)switch(config.angles){case"deg":return b(a/360*2*Math.PI);case"grad":return b(a/400*2*Math.PI);default:return b(a)}return math.collection.isCollection(a)?math.collection.deepMap(a,c):b(a)}}),["asin","acos","atan","atan2"].forEach(function(a){var b=math[a];replacements[a]=function c(a){var d=b(a);if("number"==typeof d)switch(config.angles){case"deg":return d/2/Math.PI*360;case"grad":return d/2/Math.PI*400;default:return d}return math.collection.isCollection(a)?math.collection.deepMap(a,c):d}}),math["import"](replacements,{override:!0});var context_menu={page:[["Copy","copy","normal"],["Cut","cut","normal"],["Paste","paste","normal"]],launcher:[["New Calculator","load","normal"],["In-browser Calculator","browser","normal"],["Applet Calculator","app","normal"],["","sep1","separator"]]},instanceOfKeyDown=!1,slaveWindow,cmdKey=!1;$(document).ready(function(){$("body");$("button").focus(function(){var a=this;setTimeout(function(){a.blur()},150)}),$("#angleMode").click(function(){modes=["deg","rad","grad"],index=modes.indexOf($(this).html()),index>-1&&index<modes.length-1?$(this).html(modes[index+1].toLowerCase()):$(this).html(modes[0].toLowerCase()),config.angles=$(this).html().toLowerCase()}),$("button:not('.title-bar button')").click(function(a){if(""===$(this).val()||null===$(this).val())var b=$(this).html();else var b=$(this).val();key(b.toLowerCase())}),$("li.theme").click(function(){if(theme=$("a",this).attr("id"),active=$("a","li.theme.active"),!$(this).hasClass("active")&&!$(this).hasClass("disabled")){chrome.storage.local.set({theme:theme});var a=$("body");a.removeClass($("a",active).attr("id")),active.removeClass("active"),a.removeClass(active.attr("id")),a.addClass(theme),$(this).addClass("active"),active.parent("li").removeClass("active")}}),$("li.inputset").click(function(){if(inputset=$("a",this).attr("id"),active=$("a","li.inputset.active"),!$(this).hasClass("active")&&!$(this).hasClass("disabled")){chrome.storage.local.set({inputset:inputset}),active.removeClass("active");var a=$("body");a.removeClass(active.attr("id")),a.addClass(inputset),$(this).addClass("active"),active.parent("li").removeClass("active"),chrome.runtime.getBackgroundPage(function(a){a.init(),window.close()})}}),$("li.mode").click(function(){if(mode=$("a",this).attr("id"),active=$("a","li.mode.active"),!$(this).hasClass("active")&&!$(this).hasClass("disabled")){chrome.storage.local.set({mode:mode}),active.removeClass("active");var a=$("body");a.removeClass(active.attr("id")),a.addClass(mode),$(this).addClass("active"),active.parent("li").removeClass("active"),chrome.runtime.getBackgroundPage(function(a){a.init(),window.close()})}}),$(".page button").click(function(){var a=$(this).attr("id");app===!0?chrome.runtime.getBackgroundPage(function(b){slaveWindow===!1&&(b.openText(a,id),disabled=!0)}):$("#modal .modal-Body").load("./"+a+".html",function(){$(".modal-title").html("Calculator "+a),$("#modal").modal("show"),$(".blackout").css("display","block"),disabled=!0,$("a.open").click(function(){window.open($(this).attr("href"))})})}),$("#modal").on("hide.bs.modal",function(a){$(".blackout").css("display","none"),disabled=!1}),$("#screen").click(function(a){}),app!==!0&&slaveWindow!==!0||($(".close").click(function(a){a.preventDefault(),$(this).blur(),key("close")}),$(".minimize").click(function(a){a.preventDefault(),$(this).blur(),key("minimize")})),$(".title-bar button").each(function(){$(this).hover(function(){$(this).stop().removeAttr("style").addClass("hover",250)},function(){$(this).stop().removeAttr("style").removeClass("hover",250)})}),$(document).on("DOMMouseScroll mousewheel",".calculator",function(a){a=a.originalEvent?a.originalEvent:a;var b=a.detail?a.detail*-40:a.wheelDelta;a.stopPropagation(),a.preventDefault(),a.returnValue=!1,$("#screen").scrollLeft($("#screen").scrollLeft()-b)})}),$(document).keyup(function(a){var b=a.keyCode?a.keyCode:a.which?a.which:a.charCode;if(a.preventDefault(),91===b)return void(cmdKey=!1)}),$(document).keypress(function(a){a.preventDefault()}),$(document).keydown(function(a){var b=a.keyCode?a.keyCode:a.which?a.which:a.charCode;if($(".screen").click(),instanceOfKeyDown===!0)return!1;if(instanceOfKeyDown=!0,setTimeout(function(){instanceOfKeyDown=!1},50),document.getSelection().removeAllRanges(),$("input").attr("readonly","readonly").blur(),$("#screen").blur().focus().val($("#screen").val()),91===b)return void(cmdKey=!0);if((a.ctrlKey||cmdKey)&&86===b)return Screen=$("#screen"),Screen.removeAttr("readonly").val("").focus(),setTimeout(function(){Screen.attr("readonly","readonly").blur(),paste=Screen.val(),Screen.val(0),newPaste=paste,newPaste=newPaste.replace(/[^0-9+-\/*()]/g,""),temp="";for(var a=0;a<newPaste.length;a++)console.log(newPaste[a]),key(newPaste[a])},12),!0;if(a.preventDefault(),(a.ctrlKey||cmdKey)&&88===b)key("cut");else if((a.ctrlKey||cmdKey)&&67===b)key("copy");else if(a.ctrlKey&&72===b);else if(a.ctrlKey&&a.shiftKey&&68===b);else if(showingHistory===!0);else if(a.ctrlKey&&81===b)key("M-");else if((a.ctrlKey||cmdKey)&&80===b)key("M+");else if((a.ctrlKey||cmdKey)&&77===b)key("MS");else if((a.ctrlKey||cmdKey)&&82===b)key("MR");else if((a.ctrlKey||cmdKey)&&76===b)key("MC");else if(112===b)$(".help").click();else if(121===b)$(".info").click();else if(8===b)key("backspace");else if(27===b)key("esc");else if(36===b)key("clear");else if(46===b)key("clearentry");else if(13===b||!a.shiftKey&&187===b)key("equals");else if(120===b||82===b)key("+/-");else if(a.shiftKey&&53===b)key("%");else if(a.shiftKey&&192===b)key("sqrt");else if(a.shiftKey&&57===b)key("(");else if(a.shiftKey&&48===b)key(")");else if(a.shiftKey&&49===b)key("!");else if(a.shiftKey&&54===b)key("^");else if(111===b||191===b)key("divide");else if(110===b||190===b)key(".");else if(109===b||189===b)key("minus");else if(a.shiftKey&&187===b||107===b)key("plus");else if(a.shiftKey&&56===b||106===b||88===b)key("times");else{var c=-1;for(i=96;i<106;i++)c++,b===i&&key(c);var d=-1;for(i=48;i<59;i++)d++,b===i&&key(d)}return!1}),$(window).click(function(){return!1}),$(window).resize(function(){popoutSetup()});